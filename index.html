<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Relawan - SPPG Gunung Picung</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --gray: #95a5a6;
            --sidebar-width: 250px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--primary);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .org-info {
            text-align: center;
            padding: 0 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .org-info h1 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .org-info p {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
        }
        
        .user-details {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .user-role {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 5px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .page-title {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Card Styles */
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .card-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-header h2 {
            font-size: 1.2rem;
            color: var(--primary);
        }
        
        /* Dashboard Summary */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-top: 4px solid var(--secondary);
        }
        
        .summary-card.present {
            border-top-color: var(--success);
        }
        
        .summary-card.absent {
            border-top-color: var(--danger);
        }
        
        .summary-card.leave {
            border-top-color: var(--warning);
        }
        
        .summary-card.overtime {
            border-top-color: var(--accent);
        }
        
        .summary-card h3 {
            font-size: 0.9rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .summary-card .count {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-card.present .count {
            color: var(--success);
        }
        
        .summary-card.absent .count {
            color: var(--danger);
        }
        
        .summary-card.leave .count {
            color: var(--warning);
        }
        
        .summary-card.overtime .count {
            color: var(--accent);
        }
        
        .summary-card .label {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        /* Button Styles */
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            text-align: center;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background-color: var(--secondary);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-warning {
            background-color: var(--warning);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-lg {
            padding: 15px 25px;
            font-size: 1.1rem;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .btn-edit {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-delete {
            background-color: var(--danger);
            color: white;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-present {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        
        .status-absent {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger);
        }
        
        .status-pending {
            background-color: rgba(243, 156, 18, 0.2);
            color: var(--warning);
        }
        
        /* Face Recognition */
        .face-recognition {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .camera-container {
            width: 100%;
            max-width: 500px;
            margin-bottom: 20px;
            position: relative;
            border: 2px dashed var(--secondary);
            border-radius: 8px;
            overflow: hidden;
        }
        
        #video, #video-profile {
            width: 100%;
            height: 300px;
            object-fit: cover;
            background-color: #f0f0f0;
        }
        
        .capture-btn {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 1.2rem;
        }
        
        .face-result {
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        /* Profile Section */
        .profile-section {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }
        
        .profile-image-container {
            text-align: center;
        }
        
        .profile-image {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--secondary);
            margin-bottom: 15px;
        }
        
        .profile-details {
            padding: 20px;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .detail-label {
            flex: 1;
            font-weight: 600;
            color: var(--dark);
        }
        
        .detail-value {
            flex: 2;
            color: #555;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--primary);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            text-align: right;
        }
        
        .close {
            color: #aaa;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: var(--dark);
        }
        
        /* Attendance Section */
        .attendance-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .attendance-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            min-width: 180px;
        }
        
        /* Responsive Adjustments */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .org-info,
            .sidebar .user-details,
            .sidebar .menu-text {
                display: none;
            }
            
            .sidebar .user-profile {
                justify-content: center;
            }
            
            .sidebar-menu a {
                justify-content: center;
            }
            
            .sidebar-menu i {
                margin-right: 0;
                font-size: 1.2rem;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .profile-section {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .summary-cards {
                grid-template-columns: 1fr 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .attendance-controls {
                flex-direction: column;
                align-items: center;
            }
        }
        
        @media (max-width: 576px) {
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-actions {
                margin-top: 15px;
                width: 100%;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="org-info">
            <h1>SPPG GUNUNG PICUNG</h1>
            <p>Mitra Badan Gizi Nasional</p>
            <p>Yayasan Masjid Al-Fattah Cireundeu</p>
        </div>
        
        <div class="user-profile">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-details">
                <div class="user-name">Admin Sistem</div>
                <div class="user-role">Administrator</div>
            </div>
        </div>
        
        <ul class="sidebar-menu">
            <li><a href="#" class="active" data-page="dashboard"><i class="fas fa-home"></i> <span class="menu-text">Dashboard</span></a></li>
            <li><a href="#" data-page="volunteers"><i class="fas fa-users"></i> <span class="menu-text">Data Relawan</span></a></li>
            <li><a href="#" data-page="attendance"><i class="fas fa-calendar-check"></i> <span class="menu-text">Absensi</span></a></li>
            <li><a href="#" data-page="face-recognition"><i class="fas fa-camera"></i> <span class="menu-text">Face Recognition</span></a></li>
            <li><a href="#" data-page="reports"><i class="fas fa-chart-bar"></i> <span class="menu-text">Laporan</span></a></li>
            <li><a href="#" data-page="settings"><i class="fas fa-cog"></i> <span class="menu-text">Pengaturan</span></a></li>
            <li><a href="#" data-page="logout"><i class="fas fa-sign-out-alt"></i> <span class="menu-text">Logout</span></a></li>
        </ul>
        
        <div style="padding: 20px; text-align: center; color: rgba(255,255,255,0.6); font-size: 0.8rem; margin-top: 20px;">
            Versi: 3.9.0
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Page -->
        <div class="page-content" id="dashboard">
            <div class="header">
                <h1 class="page-title">Dashboard</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="loadData()"><i class="fas fa-sync-alt"></i> Refresh</button>
                    <button class="btn"><i class="fas fa-question-circle"></i> Bantuan</button>
                </div>
            </div>
            
            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card">
                    <h3>Total Relawan</h3>
                    <div class="count" id="total-volunteers">0</div>
                    <div class="label">Orang</div>
                </div>
                <div class="summary-card present">
                    <h3>Hadir Hari Ini</h3>
                    <div class="count" id="present-count">0</div>
                    <div class="label">Relawan</div>
                </div>
                <div class="summary-card absent">
                    <h3>Tidak Hadir</h3>
                    <div class="count" id="absent-count">0</div>
                    <div class="label">Relawan</div>
                </div>
                <div class="summary-card overtime">
                    <h3>Total Gaji</h3>
                    <div class="count" id="total-salary">Rp 0</div>
                    <div class="label">Per Hari</div>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <h2>Aktivitas Terbaru</h2>
                    <button class="btn" onclick="loadAttendanceData()"><i class="fas fa-sync-alt"></i> Refresh</button>
                </div>
                <div id="recent-activities">
                    <div style="padding: 20px; text-align: center; color: var(--gray);">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Belum ada aktivitas terbaru. Silakan tambahkan data relawan terlebih dahulu.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Volunteers Management Page -->
        <div class="page-content" id="volunteers" style="display: none;">
            <div class="header">
                <h1 class="page-title">Manajemen Data Relawan</h1>
                <div class="header-actions">
                    <button class="btn btn-success" id="add-volunteer-btn"><i class="fas fa-plus"></i> Tambah Relawan</button>
                    <button class="btn btn-primary" onclick="exportData()"><i class="fas fa-download"></i> Export Data</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>Daftar Relawan</h2>
                    <div>
                        <input type="text" class="form-control" id="search-volunteer" placeholder="Cari relawan..." style="width: 250px;" onkeyup="searchVolunteers()">
                    </div>
                </div>
                
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Lengkap</th>
                                <th>Divisi</th>
                                <th>Gaji</th>
                                <th>Jam Kerja</th>
                                <th>Status Wajah</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="volunteers-table-body">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 30px; color: var(--gray);">
                                    <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 15px;"></i>
                                    <p>Belum ada data relawan. Silakan tambahkan data relawan baru.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Attendance Page -->
        <div class="page-content" id="attendance" style="display: none;">
            <div class="header">
                <h1 class="page-title">Manajemen Absensi</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="loadAttendanceData()"><i class="fas fa-sync-alt"></i> Refresh</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>Absensi Hari Ini - <span id="current-date"></span></h2>
                </div>
                
                <div class="attendance-controls">
                    <button class="btn btn-success attendance-btn" onclick="markAllPresent()"><i class="fas fa-check-circle"></i> Tandai Semua Hadir</button>
                    <button class="btn btn-danger attendance-btn" onclick="markAllAbsent()"><i class="fas fa-times-circle"></i> Tandai Semua Tidak Hadir</button>
                </div>
                
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Lengkap</th>
                                <th>Divisi</th>
                                <th>Jam Kerja</th>
                                <th>Status</th>
                                <th>Waktu Absensi</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="attendance-table-body">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 30px; color: var(--gray);">
                                    <i class="fas fa-calendar-check" style="font-size: 2rem; margin-bottom: 15px;"></i>
                                    <p>Belum ada data relawan. Silakan tambahkan data relawan terlebih dahulu.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>Riwayat Absensi</h2>
                </div>
                <div style="padding: 20px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="history-month">Bulan</label>
                            <select class="form-control" id="history-month">
                                <option value="0">Januari</option>
                                <option value="1">Februari</option>
                                <option value="2">Maret</option>
                                <option value="3">April</option>
                                <option value="4">Mei</option>
                                <option value="5">Juni</option>
                                <option value="6">Juli</option>
                                <option value="7">Agustus</option>
                                <option value="8">September</option>
                                <option value="9">Oktober</option>
                                <option value="10">November</option>
                                <option value="11">Desember</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="history-year">Tahun</label>
                            <select class="form-control" id="history-year">
                                <option value="2023">2023</option>
                                <option value="2024">2024</option>
                                <option value="2025" selected>2025</option>
                                <option value="2026">2026</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label style="opacity: 0;">Aksi</label>
                            <button class="btn btn-primary" onclick="loadAttendanceHistory()"><i class="fas fa-filter"></i> Filter</button>
                        </div>
                    </div>
                    
                    <div id="attendance-history">
                        <div style="text-align: center; color: var(--gray); padding: 20px;">
                            <i class="fas fa-history" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Belum ada riwayat absensi. Silakan pilih bulan dan tahun untuk melihat riwayat.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Face Recognition Page -->
        <div class="page-content" id="face-recognition" style="display: none;">
            <div class="header">
                <h1 class="page-title">Face Recognition</h1>
                <div class="header-actions">
                    <button class="btn" onclick="loadFaceRecognitionData()"><i class="fas fa-sync-alt"></i> Refresh</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>Registrasi Wajah Relawan</h2>
                </div>
                
                <div style="padding: 20px;">
                    <div class="form-group">
                        <label for="volunteer-select">Pilih Relawan</label>
                        <select class="form-control" id="volunteer-select" onchange="loadVolunteerDetails()">
                            <option value="">Pilih Relawan</option>
                        </select>
                    </div>
                    
                    <div id="volunteer-face-details">
                        <div style="text-align: center; padding: 20px; color: var(--gray);">
                            <i class="fas fa-user" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Silakan pilih relawan untuk melihat detail dan melakukan registrasi wajah.</p>
                        </div>
                    </div>
                    
                    <div id="face-registration-section" style="display: none;">
                        <div class="face-recognition">
                            <div class="camera-container">
                                <video id="video" autoplay playsinline></video>
                            </div>
                            
                            <button class="btn btn-success capture-btn" id="capture-btn">
                                <i class="fas fa-camera"></i> Ambil Foto untuk Registrasi
                            </button>
                            
                            <div class="face-result" id="face-result">
                                <p>Silahkan posisikan wajah di depan kamera dan klik tombol di atas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>Status Registrasi Wajah</h2>
                </div>
                
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Lengkap</th>
                                <th>Divisi</th>
                                <th>Status Registrasi</th>
                                <th>Tanggal Registrasi</th>
                            </tr>
                        </thead>
                        <tbody id="face-status-table">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 30px; color: var(--gray);">
                                    <i class="fas fa-camera" style="font-size: 2rem; margin-bottom: 15px;"></i>
                                    <p>Belum ada data registrasi wajah.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Reports Page -->
        <div class="page-content" id="reports" style="display: none;">
            <div class="header">
                <h1 class="page-title">Laporan dan Analitik</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="generateReport()"><i class="fas fa-file-pdf"></i> Export PDF</button>
                    <button class="btn btn-success" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Export Excel</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>Laporan Kehadiran</h2>
                </div>
                
                <div style="padding: 20px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="report-month">Bulan</label>
                            <select class="form-control" id="report-month">
                                <option value="0">Januari</option>
                                <option value="1">Februari</option>
                                <option value="2">Maret</option>
                                <option value="3">April</option>
                                <option value="4">Mei</option>
                                <option value="5">Juni</option>
                                <option value="6">Juli</option>
                                <option value="7">Agustus</option>
                                <option value="8">September</option>
                                <option value="9">Oktober</option>
                                <option value="10">November</option>
                                <option value="11">Desember</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="report-year">Tahun</label>
                            <select class="form-control" id="report-year">
                                <option value="2023">2023</option>
                                <option value="2024">2024</option>
                                <option value="2025" selected>2025</option>
                                <option value="2026">2026</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="report-type">Jenis Laporan</label>
                            <select class="form-control" id="report-type">
                                <option value="attendance">Laporan Kehadiran</option>
                                <option value="salary">Laporan Gaji</option>
                                <option value="summary">Ringkasan Bulanan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label style="opacity: 0;">Aksi</label>
                            <button class="btn btn-primary" onclick="loadReportData()"><i class="fas fa-filter"></i> Generate</button>
                        </div>
                    </div>
                    
                    <div id="report-results">
                        <div style="text-align: center; color: var(--gray); padding: 40px;">
                            <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <p>Silakan pilih bulan, tahun, dan jenis laporan kemudian klik Generate untuk melihat data.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Page -->
        <div class="page-content" id="settings" style="display: none;">
            <div class="header">
                <h1 class="page-title">Pengaturan Sistem</h1>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>Konfigurasi Umum</h2>
                </div>
                
                <div style="padding: 20px;">
                    <div class="form-group">
                        <label for="system-name">Nama Sistem</label>
                        <input type="text" class="form-control" id="system-name" value="Sistem Manajemen Relawan SPPG Gunung Picung">
                    </div>
                    
                    <div class="form-group">
                        <label for="organization-name">Nama Organisasi</label>
                        <input type="text" class="form-control" id="organization-name" value="SPPG Gunung Picung">
                    </div>
                    
                    <div class="form-group">
                        <label for="working-days">Hari Kerja dalam Seminggu</label>
                        <select class="form-control" id="working-days">
                            <option value="5">5 Hari (Senin-Jumat)</option>
                            <option value="6">6 Hari (Senin-Sabtu)</option>
                            <option value="7">7 Hari (Setiap Hari)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="work-start-time">Jam Mulai Kerja</label>
                        <input type="time" class="form-control" id="work-start-time" value="08:00">
                    </div>
                    
                    <div class="form-group">
                        <label for="work-end-time">Jam Selesai Kerja</label>
                        <input type="time" class="form-control" id="work-end-time" value="17:00">
                    </div>
                    
                    <div class="form-group">
                        <label for="attendance-tolerance">Toleransi Keterlambatan (menit)</label>
                        <input type="number" class="form-control" id="attendance-tolerance" value="15" min="0">
                    </div>
                    
                    <button class="btn btn-success" onclick="saveSettings()"><i class="fas fa-save"></i> Simpan Pengaturan</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2>Manajemen Data</h2>
                </div>
                
                <div style="padding: 20px;">
                    <div class="form-group">
                        <label>Cadangkan Data</label>
                        <div>
                            <button class="btn btn-primary" onclick="backupData()"><i class="fas fa-download"></i> Backup Data</button>
                            <p style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">Unduh salinan semua data sistem.</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Pulihkan Data</label>
                        <div>
                            <input type="file" id="restore-file" accept=".json" style="display: none;">
                            <button class="btn btn-warning" onclick="document.getElementById('restore-file').click()"><i class="fas fa-upload"></i> Pulihkan Data</button>
                            <p style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">Upload file backup untuk memulihkan data.</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Hapus Semua Data</label>
                        <div>
                            <button class="btn btn-danger" onclick="resetData()"><i class="fas fa-trash"></i> Hapus Semua Data</button>
                            <p style="font-size: 0.9rem; color: var(--gray); margin-top: 8px;">Hapus semua data relawan, absensi, dan pengaturan.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for Adding/Editing Volunteers -->
    <div class="modal" id="volunteer-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Tambah Relawan Baru</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="volunteer-form">
                    <input type="hidden" id="volunteer-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="volunteer-name">Nama Lengkap *</label>
                            <input type="text" class="form-control" id="volunteer-name" required>
                        </div>
                        <div class="form-group">
                            <label for="volunteer-division">Divisi *</label>
                            <select class="form-control" id="volunteer-division" required>
                                <option value="">Pilih Divisi</option>
                                <option value="ASLAP">ASLAP</option>
                                <option value="SECURITY">SECURITY</option>
                                <option value="KA. CUCI OMPRENG">KA. CUCI OMPRENG</option>
                                <option value="CUCI OMPRENG">CUCI OMPRENG</option>
                                <option value="CUCI OMPRENG/ALAT MASAK">CUCI OMPRENG/ALAT MASAK</option>
                                <option value="KEPALA DRIVER">KEPALA DRIVER</option>
                                <option value="DRIVER">DRIVER</option>
                                <option value="KENEK">KENEK</option>
                                <option value="KEPALA DAPUR">KEPALA DAPUR</option>
                                <option value="MASAK">MASAK</option>
                                <option value="KEPALA PEMORSIAN">KEPALA PEMORSIAN</option>
                                <option value="PEMORSIAN">PEMORSIAN</option>
                                <option value="KEPALA PERSIAPAN">KEPALA PERSIAPAN</option>
                                <option value="PERSIAPAN">PERSIAPAN</option>
                                <option value="PENGIKATAN">PENGIKATAN</option>
                                <option value="SANITASI & LIMBAH">SANITASI & LIMBAH</option>
                                <option value="OB">OB</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="volunteer-salary">Gaji per Hari (Rp) *</label>
                            <input type="number" class="form-control" id="volunteer-salary" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="volunteer-schedule">Jam Kerja *</label>
                            <input type="text" class="form-control" id="volunteer-schedule" placeholder="Contoh: 08.00 - 16.00" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="volunteer-notes">Catatan Tambahan</label>
                        <textarea class="form-control" id="volunteer-notes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="cancel-btn">Batal</button>
                <button type="button" class="btn btn-success" id="save-volunteer-btn">Simpan Data</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let volunteers = JSON.parse(localStorage.getItem('volunteers')) || [];
        let attendance = JSON.parse(localStorage.getItem('attendance')) || {};
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            systemName: "Sistem Manajemen Relawan SPPG Gunung Picung",
            organizationName: "SPPG Gunung Picung",
            workingDays: 5,
            workStartTime: "08:00",
            workEndTime: "17:00",
            attendanceTolerance: 15
        };
        let editingId = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize settings
            initializeSettings();
            
            // Navigation handling
            const navLinks = document.querySelectorAll('.sidebar-menu a');
            const pageContents = document.querySelectorAll('.page-content');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Handle logout
                    if (this.getAttribute('data-page') === 'logout') {
                        if (confirm('Apakah Anda yakin ingin logout?')) {
                            alert('Logout berhasil!');
                            return;
                        }
                    }
                    
                    // Remove active class from all links
                    navLinks.forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Hide all page contents
                    pageContents.forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    // Show the selected page
                    const pageId = this.getAttribute('data-page');
                    document.getElementById(pageId).style.display = 'block';
                    
                    // Load data for the specific page
                    switch(pageId) {
                        case 'dashboard':
                            loadDashboardData();
                            break;
                        case 'volunteers':
                            loadVolunteersData();
                            break;
                        case 'attendance':
                            loadAttendanceData();
                            break;
                        case 'face-recognition':
                            loadFaceRecognitionData();
                            break;
                        case 'reports':
                            loadReportData();
                            break;
                        case 'settings':
                            loadSettings();
                            break;
                    }
                });
            });
            
            // Volunteer modal handling
            const modal = document.getElementById('volunteer-modal');
            const addVolunteerBtn = document.getElementById('add-volunteer-btn');
            const closeBtn = document.querySelector('.close');
            const cancelBtn = document.getElementById('cancel-btn');
            const saveVolunteerBtn = document.getElementById('save-volunteer-btn');
            const volunteerForm = document.getElementById('volunteer-form');
            
            addVolunteerBtn.addEventListener('click', function() {
                editingId = null;
                document.getElementById('modal-title').textContent = 'Tambah Relawan Baru';
                volunteerForm.reset();
                modal.style.display = 'flex';
            });
            
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            cancelBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            saveVolunteerBtn.addEventListener('click', function() {
                if (validateVolunteerForm()) {
                    saveVolunteerData();
                }
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // File input for restore
            document.getElementById('restore-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    restoreData(file);
                }
            });
            
            // Set current date
            const now = new Date();
            document.getElementById('current-date').textContent = now.toLocaleDateString('id-ID', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Load initial data
            loadDashboardData();
        });
        
        function initializeSettings() {
            if (!localStorage.getItem('settings')) {
                localStorage.setItem('settings', JSON.stringify(settings));
            } else {
                settings = JSON.parse(localStorage.getItem('settings'));
            }
        }
        
        function loadDashboardData() {
            loadVolunteersData();
            updateDashboardSummary();
            loadRecentActivities();
        }
        
        function updateDashboardSummary() {
            const presentToday = volunteers.filter(v => {
                const today = new Date().toISOString().split('T')[0];
                return attendance[today] && attendance[today][v.id] && attendance[today][v.id].status === 'present';
            }).length;
            
            document.getElementById('total-volunteers').textContent = volunteers.length;
            document.getElementById('present-count').textContent = presentToday;
            document.getElementById('absent-count').textContent = volunteers.length - presentToday;
            
            const totalSalary = volunteers.reduce((sum, volunteer) => sum + volunteer.salary, 0);
            document.getElementById('total-salary').textContent = `Rp ${totalSalary.toLocaleString('id-ID')}`;
        }
        
        function loadRecentActivities() {
            const activitiesContainer = document.getElementById('recent-activities');
            
            if (volunteers.length === 0) {
                activitiesContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--gray);">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Belum ada aktivitas terbaru. Silakan tambahkan data relawan terlebih dahulu.</p>
                    </div>
                `;
                return;
            }
            
            // Get today's date
            const today = new Date().toISOString().split('T')[0];
            
            // Check if we have attendance data for today
            if (!attendance[today] || Object.keys(attendance[today]).length === 0) {
                activitiesContainer.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--gray);">
                        <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Belum ada absensi hari ini. Silakan input data absensi di halaman Absensi.</p>
                    </div>
                `;
                return;
            }
            
            // Display recent activities
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Nama</th>
                            <th>Divisi</th>
                            <th>Waktu</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const volunteerId in attendance[today]) {
                const record = attendance[today][volunteerId];
                const volunteer = volunteers.find(v => v.id === volunteerId);
                
                if (volunteer) {
                    html += `
                        <tr>
                            <td>${volunteer.name}</td>
                            <td>${volunteer.division}</td>
                            <td>${record.time || '-'}</td>
                            <td><span class="status-badge ${record.status === 'present' ? 'status-present' : 'status-absent'}">${record.status === 'present' ? 'Hadir' : 'Tidak Hadir'}</span></td>
                        </tr>
                    `;
                }
            }
            
            html += `
                    </tbody>
                </table>
            `;
            
            activitiesContainer.innerHTML = html;
        }
        
        function loadVolunteersData() {
            const volunteersTable = document.getElementById('volunteers-table-body');
            
            // Clear table
            volunteersTable.innerHTML = '';
            
            if (volunteers.length === 0) {
                volunteersTable.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px; color: var(--gray);">
                            <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Belum ada data relawan. Silakan tambahkan data relawan baru.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Add volunteers to table
            volunteers.forEach((volunteer, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${volunteer.name}</td>
                    <td>${volunteer.division}</td>
                    <td>Rp ${volunteer.salary.toLocaleString('id-ID')}</td>
                    <td>${volunteer.schedule}</td>
                    <td><span class="status-badge ${volunteer.faceRegistered ? 'status-present' : 'status-pending'}">${volunteer.faceRegistered ? 'Terdaftar' : 'Belum Terdaftar'}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-edit action-btn" data-id="${volunteer.id}"><i class="fas fa-edit"></i> Edit</button>
                            <button class="btn-delete action-btn" data-id="${volunteer.id}"><i class="fas fa-trash"></i> Hapus</button>
                        </div>
                    </td>
                `;
                
                volunteersTable.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    editVolunteer(id);
                });
            });
            
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteVolunteer(id);
                });
            });
        }
        
        function loadAttendanceData() {
            const attendanceTable = document.getElementById('attendance-table-body');
            const today = new Date().toISOString().split('T')[0];
            
            // Clear table
            attendanceTable.innerHTML = '';
            
            if (volunteers.length === 0) {
                attendanceTable.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px; color: var(--gray);">
                            <i class="fas fa-calendar-check" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Belum ada data relawan. Silakan tambahkan data relawan terlebih dahulu.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Initialize today's attendance if not exists
            if (!attendance[today]) {
                attendance[today] = {};
            }
            
            // Add volunteers to attendance table
            volunteers.forEach((volunteer, index) => {
                const row = document.createElement('tr');
                const attendanceRecord = attendance[today][volunteer.id] || { status: 'absent', time: null };
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${volunteer.name}</td>
                    <td>${volunteer.division}</td>
                    <td>${volunteer.schedule}</td>
                    <td><span class="status-badge ${attendanceRecord.status === 'present' ? 'status-present' : 'status-absent'}">${attendanceRecord.status === 'present' ? 'Hadir' : 'Tidak Hadir'}</span></td>
                    <td>${attendanceRecord.time || '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-success action-btn" onclick="markAttendance('${volunteer.id}', 'present')"><i class="fas fa-check"></i> Hadir</button>
                            <button class="btn-danger action-btn" onclick="markAttendance('${volunteer.id}', 'absent')"><i class="fas fa-times"></i> Tidak Hadir</button>
                        </div>
                    </td>
                `;
                
                attendanceTable.appendChild(row);
            });
        }
        
        function loadAttendanceHistory() {
            const month = document.getElementById('history-month').value;
            const year = document.getElementById('history-year').value;
            const historyContainer = document.getElementById('attendance-history');
            
            // Filter attendance data by month and year
            const filteredAttendance = {};
            
            for (const date in attendance) {
                const dateObj = new Date(date);
                if (dateObj.getMonth() == month && dateObj.getFullYear() == year) {
                    filteredAttendance[date] = attendance[date];
                }
            }
            
            if (Object.keys(filteredAttendance).length === 0) {
                historyContainer.innerHTML = `
                    <div style="text-align: center; color: var(--gray); padding: 20px;">
                        <i class="fas fa-history" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Tidak ada data absensi untuk bulan dan tahun yang dipilih.</p>
                    </div>
                `;
                return;
            }
            
            // Generate attendance history table
            let html = `
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Tanggal</th>
            `;
            
            // Add volunteer names as headers
            volunteers.forEach(volunteer => {
                html += `<th>${volunteer.name}</th>`;
            });
            
            html += `
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // Add attendance data for each date
            for (const date in filteredAttendance) {
                const dateObj = new Date(date);
                html += `<tr><td>${dateObj.toLocaleDateString('id-ID')}</td>`;
                
                volunteers.forEach(volunteer => {
                    const status = filteredAttendance[date][volunteer.id]?.status || 'absent';
                    html += `<td><span class="status-badge ${status === 'present' ? 'status-present' : 'status-absent'}">${status === 'present' ? 'H' : 'T'}</span></td>`;
                });
                
                html += `</tr>`;
            }
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            historyContainer.innerHTML = html;
        }
        
        function loadFaceRecognitionData() {
            const volunteerSelect = document.getElementById('volunteer-select');
            
            // Clear existing options
            volunteerSelect.innerHTML = '<option value="">Pilih Relawan</option>';
            
            // Add volunteers to select
            volunteers.forEach(volunteer => {
                const option = document.createElement('option');
                option.value = volunteer.id;
                option.textContent = volunteer.name;
                volunteerSelect.appendChild(option);
            });
            
            // Load face status table
            loadFaceStatusTable();
        }
        
        function loadVolunteerDetails() {
            const volunteerId = document.getElementById('volunteer-select').value;
            const detailsContainer = document.getElementById('volunteer-face-details');
            const faceSection = document.getElementById('face-registration-section');
            
            if (!volunteerId) {
                detailsContainer.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--gray);">
                        <i class="fas fa-user" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Silakan pilih relawan untuk melihat detail dan melakukan registrasi wajah.</p>
                    </div>
                `;
                faceSection.style.display = 'none';
                return;
            }
            
            const volunteer = volunteers.find(v => v.id === volunteerId);
            
            if (volunteer) {
                detailsContainer.innerHTML = `
                    <div class="profile-section">
                        <div class="profile-image-container">
                            <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(volunteer.name)}&background=3498db&color=fff&size=200" alt="Profile" class="profile-image">
                            <div class="face-status">
                                <span class="status-badge ${volunteer.faceRegistered ? 'status-present' : 'status-pending'}">${volunteer.faceRegistered ? 'Wajah Terdaftar' : 'Wajah Belum Terdaftar'}</span>
                            </div>
                        </div>
                        <div class="profile-details">
                            <div class="detail-row">
                                <div class="detail-label">Nama Lengkap:</div>
                                <div class="detail-value">${volunteer.name}</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Divisi:</div>
                                <div class="detail-value">${volunteer.division}</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Jam Kerja:</div>
                                <div class="detail-value">${volunteer.schedule}</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Gaji per Hari:</div>
                                <div class="detail-value">Rp ${volunteer.salary.toLocaleString('id-ID')}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Show face registration section if not registered
                faceSection.style.display = volunteer.faceRegistered ? 'none' : 'block';
                
                // Initialize camera if needed
                if (!volunteer.faceRegistered) {
                    initFaceRegistration();
                }
            }
        }
        
        function loadFaceStatusTable() {
            const statusTable = document.getElementById('face-status-table');
            
            // Clear table
            statusTable.innerHTML = '';
            
            if (volunteers.length === 0) {
                statusTable.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px; color: var(--gray);">
                            <i class="fas fa-camera" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Belum ada data registrasi wajah.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Add volunteers to status table
            volunteers.forEach((volunteer, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${volunteer.name}</td>
                    <td>${volunteer.division}</td>
                    <td><span class="status-badge ${volunteer.faceRegistered ? 'status-present' : 'status-pending'}">${volunteer.faceRegistered ? 'Terdaftar' : 'Belum Terdaftar'}</span></td>
                    <td>${volunteer.faceRegistered ? new Date(volunteer.faceRegistrationDate).toLocaleDateString('id-ID') : '-'}</td>
                `;
                
                statusTable.appendChild(row);
            });
        }
        
        function loadReportData() {
            const month = document.getElementById('report-month').value;
            const year = document.getElementById('report-year').value;
            const reportType = document.getElementById('report-type').value;
            const reportContainer = document.getElementById('report-results');
            
            if (volunteers.length === 0) {
                reportContainer.innerHTML = `
                    <div style="text-align: center; color: var(--gray); padding: 40px;">
                        <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>Belum ada data relawan. Silakan tambahkan data relawan terlebih dahulu.</p>
                    </div>
                `;
                return;
            }
            
            // Filter attendance data by month and year
            const filteredAttendance = {};
            
            for (const date in attendance) {
                const dateObj = new Date(date);
                if (dateObj.getMonth() == month && dateObj.getFullYear() == year) {
                    filteredAttendance[date] = attendance[date];
                }
            }
            
            let html = '';
            
            switch(reportType) {
                case 'attendance':
                    html = generateAttendanceReport(filteredAttendance);
                    break;
                case 'salary':
                    html = generateSalaryReport(filteredAttendance);
                    break;
                case 'summary':
                    html = generateSummaryReport(filteredAttendance);
                    break;
            }
            
            reportContainer.innerHTML = html;
        }
        
        function generateAttendanceReport(attendanceData) {
            let html = `
                <h3 style="margin-bottom: 20px;">Laporan Kehadiran Bulanan</h3>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Nama Relawan</th>
                                <th>Divisi</th>
                                <th>Total Hadir</th>
                                <th>Total Tidak Hadir</th>
                                <th>Persentase Kehadiran</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            volunteers.forEach(volunteer => {
                let presentCount = 0;
                let totalDays = Object.keys(attendanceData).length;
                
                for (const date in attendanceData) {
                    if (attendanceData[date][volunteer.id]?.status === 'present') {
                        presentCount++;
                    }
                }
                
                const absentCount = totalDays - presentCount;
                const attendancePercentage = totalDays > 0 ? ((presentCount / totalDays) * 100).toFixed(2) : 0;
                
                html += `
                    <tr>
                        <td>${volunteer.name}</td>
                        <td>${volunteer.division}</td>
                        <td>${presentCount}</td>
                        <td>${absentCount}</td>
                        <td>${attendancePercentage}%</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            return html;
        }
        
        function generateSalaryReport(attendanceData) {
            let html = `
                <h3 style="margin-bottom: 20px;">Laporan Gaji Bulanan</h3>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Nama Relawan</th>
                                <th>Divisi</th>
                                <th>Gaji per Hari</th>
                                <th>Total Hari Kerja</th>
                                <th>Total Gaji</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            let totalSalary = 0;
            
            volunteers.forEach(volunteer => {
                let presentCount = 0;
                
                for (const date in attendanceData) {
                    if (attendanceData[date][volunteer.id]?.status === 'present') {
                        presentCount++;
                    }
                }
                
                const salary = presentCount * volunteer.salary;
                totalSalary += salary;
                
                html += `
                    <tr>
                        <td>${volunteer.name}</td>
                        <td>${volunteer.division}</td>
                        <td>Rp ${volunteer.salary.toLocaleString('id-ID')}</td>
                        <td>${presentCount}</td>
                        <td>Rp ${salary.toLocaleString('id-ID')}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="4" style="text-align: right; font-weight: bold;">Total:</td>
                                <td style="font-weight: bold;">Rp ${totalSalary.toLocaleString('id-ID')}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;
            
            return html;
        }
        
        function generateSummaryReport(attendanceData) {
            let presentCount = 0;
            let totalDays = Object.keys(attendanceData).length;
            let totalWorkDays = totalDays * volunteers.length;
            
            for (const date in attendanceData) {
                for (const volunteerId in attendanceData[date]) {
                    if (attendanceData[date][volunteerId]?.status === 'present') {
                        presentCount++;
                    }
                }
            }
            
            const absentCount = totalWorkDays - presentCount;
            const attendancePercentage = totalWorkDays > 0 ? ((presentCount / totalWorkDays) * 100).toFixed(2) : 0;
            
            let html = `
                <h3 style="margin-bottom: 20px;">Ringkasan Bulanan</h3>
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3>Total Hari Kerja</h3>
                        <div class="count">${totalDays}</div>
                        <div class="label">Hari</div>
                    </div>
                    <div class="summary-card present">
                        <h3>Total Kehadiran</h3>
                        <div class="count">${presentCount}</div>
                        <div class="label">Absensi</div>
                    </div>
                    <div class="summary-card absent">
                        <h3>Total Ketidakhadiran</h3>
                        <div class="count">${absentCount}</div>
                        <div class="label">Absensi</div>
                    </div>
                    <div class="summary-card overtime">
                        <h3>Persentase Kehadiran</h3>
                        <div class="count">${attendancePercentage}%</div>
                        <div class="label">Rata-rata</div>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function loadSettings() {
            document.getElementById('system-name').value = settings.systemName;
            document.getElementById('organization-name').value = settings.organizationName;
            document.getElementById('working-days').value = settings.workingDays;
            document.getElementById('work-start-time').value = settings.workStartTime;
            document.getElementById('work-end-time').value = settings.workEndTime;
            document.getElementById('attendance-tolerance').value = settings.attendanceTolerance;
        }
        
        function validateVolunteerForm() {
            const name = document.getElementById('volunteer-name').value.trim();
            const division = document.getElementById('volunteer-division').value;
            const salary = document.getElementById('volunteer-salary').value;
            const schedule = document.getElementById('volunteer-schedule').value.trim();
            
            if (!name) {
                alert('Nama lengkap harus diisi!');
                return false;
            }
            
            if (!division) {
                alert('Divisi harus dipilih!');
                return false;
            }
            
            if (!salary || salary <= 0) {
                alert('Gaji harus diisi dengan nilai yang valid!');
                return false;
            }
            
            if (!schedule) {
                alert('Jam kerja harus diisi!');
                return false;
            }
            
            return true;
        }
        
        function saveVolunteerData() {
            const id = editingId || Date.now().toString();
            const name = document.getElementById('volunteer-name').value.trim();
            const division = document.getElementById('volunteer-division').value;
            const salary = parseInt(document.getElementById('volunteer-salary').value);
            const schedule = document.getElementById('volunteer-schedule').value.trim();
            const notes = document.getElementById('volunteer-notes').value.trim();
            
            if (editingId) {
                // Update existing volunteer
                const index = volunteers.findIndex(v => v.id === editingId);
                if (index !== -1) {
                    volunteers[index] = { 
                        ...volunteers[index], 
                        name, 
                        division, 
                        salary, 
                        schedule, 
                        notes 
                    };
                }
            } else {
                // Add new volunteer
                volunteers.push({ 
                    id, 
                    name, 
                    division, 
                    salary, 
                    schedule, 
                    notes,
                    faceRegistered: false
                });
            }
            
            // Save to localStorage
            localStorage.setItem('volunteers', JSON.stringify(volunteers));
            
            // Close modal and refresh data
            document.getElementById('volunteer-modal').style.display = 'none';
            loadVolunteersData();
            loadDashboardData();
            
            alert(`Data relawan ${editingId ? 'diperbarui' : 'ditambahkan'} successfully!`);
        }
        
        function editVolunteer(id) {
            const volunteer = volunteers.find(v => v.id === id);
            if (!volunteer) return;
            
            editingId = id;
            document.getElementById('modal-title').textContent = 'Edit Data Relawan';
            document.getElementById('volunteer-id').value = volunteer.id;
            document.getElementById('volunteer-name').value = volunteer.name;
            document.getElementById('volunteer-division').value = volunteer.division;
            document.getElementById('volunteer-salary').value = volunteer.salary;
            document.getElementById('volunteer-schedule').value = volunteer.schedule;
            document.getElementById('volunteer-notes').value = volunteer.notes || '';
            
            document.getElementById('volunteer-modal').style.display = 'flex';
        }
        
        function deleteVolunteer(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data relawan ini?')) return;
            
            volunteers = volunteers.filter(v => v.id !== id);
            localStorage.setItem('volunteers', JSON.stringify(volunteers));
            
            // Remove from attendance records
            for (const date in attendance) {
                if (attendance[date][id]) {
                    delete attendance[date][id];
                }
            }
            localStorage.setItem('attendance', JSON.stringify(attendance));
            
            loadVolunteersData();
            loadDashboardData();
            
            alert('Data relawan berhasil dihapus!');
        }
        
        function markAttendance(volunteerId, status) {
            const today = new Date().toISOString().split('T')[0];
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            
            // Initialize today's attendance if not exists
            if (!attendance[today]) {
                attendance[today] = {};
            }
            
            // Update attendance record
            attendance[today][volunteerId] = {
                status: status,
                time: status === 'present' ? timeString : null
            };
            
            // Save to localStorage
            localStorage.setItem('attendance', JSON.stringify(attendance));
            
            // Refresh attendance data
            loadAttendanceData();
            loadDashboardData();
            
            alert(`Absensi berhasil dicatat untuk status: ${status === 'present' ? 'Hadir' : 'Tidak Hadir'}`);
        }
        
        function markAllPresent() {
            if (!confirm('Tandai semua relawan sebagai hadir?')) return;
            
            const today = new Date().toISOString().split('T')[0];
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            
            // Initialize today's attendance if not exists
            if (!attendance[today]) {
                attendance[today] = {};
            }
            
            // Mark all volunteers as present
            volunteers.forEach(volunteer => {
                attendance[today][volunteer.id] = {
                    status: 'present',
                    time: timeString
                };
            });
            
            // Save to localStorage
            localStorage.setItem('attendance', JSON.stringify(attendance));
            
            // Refresh attendance data
            loadAttendanceData();
            loadDashboardData();
            
            alert('Semua relawan berhasil ditandai sebagai hadir!');
        }
        
        function markAllAbsent() {
            if (!confirm('Tandai semua relawan sebagai tidak hadir?')) return;
            
            const today = new Date().toISOString().split('T')[0];
            
            // Initialize today's attendance if not exists
            if (!attendance[today]) {
                attendance[today] = {};
            }
            
            // Mark all volunteers as absent
            volunteers.forEach(volunteer => {
                attendance[today][volunteer.id] = {
                    status: 'absent',
                    time: null
                };
            });
            
            // Save to localStorage
            localStorage.setItem('attendance', JSON.stringify(attendance));
            
            // Refresh attendance data
            loadAttendanceData();
            loadDashboardData();
            
            alert('Semua relawan berhasil ditandai sebagai tidak hadir!');
        }
        
        function initFaceRegistration() {
            const video = document.getElementById('video');
            const captureBtn = document.getElementById('capture-btn');
            const faceResult = document.getElementById('face-result');
            
            // Access webcam
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        video.srcObject = stream;
                        video.play();
                    })
                    .catch(function(error) {
                        faceResult.innerHTML = '<p style="color: var(--danger);">Tidak dapat mengakses kamera: ' + error.message + '</p>';
                    });
            } else {
                faceResult.innerHTML = '<p style="color: var(--danger);">Browser tidak mendukung akses kamera</p>';
            }
            
            // Capture button event
            captureBtn.addEventListener('click', function() {
                // Simulate face registration process
                simulateFaceRegistration();
            });
        }
        
        function simulateFaceRegistration() {
            const volunteerId = document.getElementById('volunteer-select').value;
            const faceResult = document.getElementById('face-result');
            const captureBtn = document.getElementById('capture-btn');
            
            if (!volunteerId) {
                alert('Silakan pilih relawan terlebih dahulu!');
                return;
            }
            
            // Show loading state
            captureBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
            captureBtn.disabled = true;
            
            // Simulate processing time
            setTimeout(() => {
                // Find volunteer
                const volunteerIndex = volunteers.findIndex(v => v.id === volunteerId);
                if (volunteerIndex === -1) return;
                
                // Update volunteer data
                volunteers[volunteerIndex].faceRegistered = true;
                volunteers[volunteerIndex].faceRegistrationDate = new Date().toISOString();
                
                // Save to localStorage
                localStorage.setItem('volunteers', JSON.stringify(volunteers));
                
                // Show success result
                faceResult.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; color: var(--success); margin-bottom: 15px;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 style="color: var(--success); margin-bottom: 10px;">Registrasi Berhasil!</h3>
                        <p>Wajah ${volunteers[volunteerIndex].name} telah terdaftar dalam sistem</p>
                    </div>
                `;
                
                // Hide registration section
                document.getElementById('face-registration-section').style.display = 'none';
                
                // Update volunteer details
                loadVolunteerDetails();
                
                // Update face status table
                loadFaceStatusTable();
                
                // Reset button
                captureBtn.innerHTML = '<i class="fas fa-camera"></i> Ambil Foto untuk Registrasi';
                captureBtn.disabled = false;
            }, 2000);
        }
        
        function saveSettings() {
            settings.systemName = document.getElementById('system-name').value;
            settings.organizationName = document.getElementById('organization-name').value;
            settings.workingDays = parseInt(document.getElementById('working-days').value);
            settings.workStartTime = document.getElementById('work-start-time').value;
            settings.workEndTime = document.getElementById('work-end-time').value;
            settings.attendanceTolerance = parseInt(document.getElementById('attendance-tolerance').value);
            
            // Save to localStorage
            localStorage.setItem('settings', JSON.stringify(settings));
            
            alert('Pengaturan berhasil disimpan!');
        }
        
        function backupData() {
            const data = {
                volunteers: volunteers,
                attendance: attendance,
                settings: settings,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `backup-sistem-relawan-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        function restoreData(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('Apakah Anda yakin ingin memulihkan data? Data saat ini akan digantikan dengan data backup.')) {
                        if (data.volunteers) {
                            volunteers = data.volunteers;
                            localStorage.setItem('volunteers', JSON.stringify(volunteers));
                        }
                        
                        if (data.attendance) {
                            attendance = data.attendance;
                            localStorage.setItem('attendance', JSON.stringify(attendance));
                        }
                        
                        if (data.settings) {
                            settings = data.settings;
                            localStorage.setItem('settings', JSON.stringify(settings));
                        }
                        
                        alert('Data berhasil dipulihkan!');
                        loadDashboardData();
                    }
                } catch (error) {
                    alert('Error memulihkan data: File tidak valid.');
                    console.error('Restore error:', error);
                }
            };
            
            reader.readAsText(file);
        }
        
        function resetData() {
            if (confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) {
                volunteers = [];
                attendance = {};
                settings = {
                    systemName: "Sistem Manajemen Relawan SPPG Gunung Picung",
                    organizationName: "SPPG Gunung Picung",
                    workingDays: 5,
                    workStartTime: "08:00",
                    workEndTime: "17:00",
                    attendanceTolerance: 15
                };
                
                localStorage.setItem('volunteers', JSON.stringify(volunteers));
                localStorage.setItem('attendance', JSON.stringify(attendance));
                localStorage.setItem('settings', JSON.stringify(settings));
                
                alert('Semua data berhasil dihapus!');
                loadDashboardData();
            }
        }
        
        function exportData() {
            if (volunteers.length === 0) {
                alert('Tidak ada data untuk diexport!');
                return;
            }
            
            let csvContent = "Nama,Divisi,Gaji,Jam Kerja,Status Wajah\n";
            
            volunteers.forEach(volunteer => {
                csvContent += `"${volunteer.name}","${volunteer.division}","${volunteer.salary}","${volunteer.schedule}","${volunteer.faceRegistered ? 'Terdaftar' : 'Belum Terdaftar'}"\n`;
            });
            
            const encodedUri = encodeURI("data:text/csv;charset=utf-8," + csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `data-relawan-${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            
            link.click();
            document.body.removeChild(link);
        }
        
        function searchVolunteers() {
            const searchTerm = document.getElementById('search-volunteer').value.toLowerCase();
            const volunteersTable = document.getElementById('volunteers-table-body');
            
            // Clear table
            volunteersTable.innerHTML = '';
            
            if (volunteers.length === 0) {
                volunteersTable.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px; color: var(--gray);">
                            <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Belum ada data relawan. Silakan tambahkan data relawan baru.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Filter volunteers based on search term
            const filteredVolunteers = volunteers.filter(volunteer => 
                volunteer.name.toLowerCase().includes(searchTerm) || 
                volunteer.division.toLowerCase().includes(searchTerm)
            );
            
            if (filteredVolunteers.length === 0) {
                volunteersTable.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px; color: var(--gray);">
                            <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Tidak ada relawan yang sesuai dengan pencarian.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Add filtered volunteers to table
            filteredVolunteers.forEach((volunteer, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${volunteer.name}</td>
                    <td>${volunteer.division}</td>
                    <td>Rp ${volunteer.salary.toLocaleString('id-ID')}</td>
                    <td>${volunteer.schedule}</td>
                    <td><span class="status-badge ${volunteer.faceRegistered ? 'status-present' : 'status-pending'}">${volunteer.faceRegistered ? 'Terdaftar' : 'Belum Terdaftar'}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-edit action-btn" data-id="${volunteer.id}"><i class="fas fa-edit"></i> Edit</button>
                            <button class="btn-delete action-btn" data-id="${volunteer.id}"><i class="fas fa-trash"></i> Hapus</button>
                        </div>
                    </td>
                `;
                
                volunteersTable.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    editVolunteer(id);
                });
            });
            
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteVolunteer(id);
                });
            });
        }
        
        function generateReport() {
            alert('Fitur export PDF akan segera hadir!');
        }
        
        function exportToExcel() {
            alert('Fitur export Excel akan segera hadir!');
        }
        
        function loadData() {
            volunteers = JSON.parse(localStorage.getItem('volunteers')) || [];
            attendance = JSON.parse(localStorage.getItem('attendance')) || {};
            settings = JSON.parse(localStorage.getItem('settings')) || {
                systemName: "Sistem Manajemen Relawan SPPG Gunung Picung",
                organizationName: "SPPG Gunung Picung",
                workingDays: 5,
                workStartTime: "08:00",
                workEndTime: "17:00",
                attendanceTolerance: 15
            };
            
            loadDashboardData();
            alert('Data berhasil dimuat ulang!');
        }
    </script>
</body>
</html>
